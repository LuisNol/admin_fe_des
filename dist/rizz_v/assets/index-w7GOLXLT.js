import{h as X,j as Y,r as u,w as M,_ as Z,l as j,m as s,q as r,t as a,L as ee,v as te,Q as ae,N as se,R as le,J as y,D as N,u as S,M as oe,y as e,E as ne,x as re,B as c,G as E,F as w,a2 as ie,H as f,a3 as ue,I as de}from"./index-D8mrUL2h.js";import{_ as ce}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-Cx4oJ_hT.js";import{H as V}from"./http-client-9jyrWv7H.js";import{S as b}from"./sweetalert2-DId3skXs.js";import"./logo-sm-CPlBPHhB.js";const me=[{name:"Dashboard",permisos:[{name:"Graficos",permiso:"dashboard"}]},{name:"Roles",permisos:[{name:"Registrar",permiso:"register_role"},{name:"Listado",permiso:"list_role"},{name:"Editar",permiso:"edit_role"},{name:"Eliminar",permiso:"delete_role"}]},{name:"Usuarios",permisos:[{name:"Registrar",permiso:"register_user"},{name:"Listado",permiso:"list_user"},{name:"Editar",permiso:"edit_user"},{name:"Eliminar",permiso:"delete_user"}]},{name:"Categorias",permisos:[{name:"Registrar",permiso:"register_categorie"},{name:"Listado",permiso:"list_categorie"},{name:"Editar",permiso:"edit_categorie"},{name:"Eliminar",permiso:"delete_categorie"}]},{name:"Productos",permisos:[{name:"Registrar",permiso:"register_product"},{name:"Listado",permiso:"list_product"},{name:"Editar",permiso:"edit_product"},{name:"Eliminar",permiso:"delete_product"}]},{name:"Clientes",permisos:[{name:"Registrar",permiso:"register_client"},{name:"Listado",permiso:"list_client"},{name:"Editar",permiso:"edit_client"},{name:"Eliminar",permiso:"delete_client"}]},{name:"Venta",permisos:[{name:"Registrar",permiso:"register_sale"},{name:"Listado",permiso:"list_sale"},{name:"Editar",permiso:"edit_sale"},{name:"Eliminar",permiso:"delete_sale"}]},{name:"Nota EletrÃ³nica",permisos:[{name:"Registrar",permiso:"nota_electronica"},{name:"Listado",permiso:"list_nota_electronica"}]},{name:"Guia de RemisiÃ³n",permisos:[{name:"Registrar",permiso:"register_guia_remision"},{name:"Listado",permiso:"list_guia_remision"}]}],_e=e("i",{class:"far fa-plus-square ml-3"},null,-1),pe=e("i",{class:"fas fa-search"},null,-1),fe=e("i",{class:"fas fa-sync"},null,-1),ve={class:"table-responsive m-0"},ge={class:"table datatable",id:"datatable_1"},he=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Id"),e("th",null,"Role"),e("th",null,"Permisos"),e("th",null,"Fecha R."),e("th",null,"Acciones")])],-1),be=["onClick"],ye=e("i",{class:"las la-pen text-secondary fs-22"},null,-1),ke=[ye],xe=["onClick"],Ce=e("i",{class:"las la-trash-alt text-secondary fs-22"},null,-1),Re=[Ce],Ee=e("label",{for:"role",class:"col-form-label text-lg-end"},"Nombre del Rol",-1),we={class:"table table-responsive"},Ve=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Modulo"),e("th",null,"Permisos")])],-1),Pe={class:"mx-1"},Le={class:"modal-footer"},Me=X({__name:"index",setup(Be){const P=Y(),v=u([]),m=u(""),_=u(!1),I=u("primary"),A=u(me),i=u([]),p=u(),k=u(1),U=u(0),$=u(1),x=u(""),C=async()=>{try{const t=await V.get("roles?page="+k.value+"&search="+(x.value??""));console.log(t),v.value=t.data.roles,U.value=t.data.total,$.value=t.data.pagination}catch(t){console.log(t)}},H=()=>{x.value="",C()},q=async t=>{let l=i.value.findIndex(d=>d==t.permiso);l!=-1?i.value.splice(l,1):i.value.push(t.permiso),console.log(i.value)},D=async()=>{try{if(!m.value){b.fire("Upps!","El campo nombre es obligatorio","error");return}if(i.value.length==0){b.fire("Upps!","Necesitas seleccionar al menos un permiso","error");return}let t;if(p.value?t=await V.put("roles/"+p.value.id,{name:m.value,permissions:i.value}):t=await V.post("roles",{name:m.value,permissions:i.value}),console.log(t),t.data.code==405)b.fire("Upps!",t.data.message,"error");else{if(p.value){let l=v.value.findIndex(d=>{var n;return d.id==((n=p.value)==null?void 0:n.id)});l!=-1&&(v.value[l]=t.data.role)}else v.value.unshift(t.data.role);_.value=!1,m.value="",i.value=[],b.fire("Genial!",t.data.message,"success")}}catch(t){console.log(t)}},F=async t=>{b.fire({title:"Confirmar la eliminaciÃ³n",text:"Â¿Estas seguro de eliminar este rol ''"+t.name+"'' ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminalo!"}).then(async l=>{if(l.isConfirmed)try{const d=await V.delete("roles/"+t.id);console.log(d),b.fire("Genial!",d.data.message,"success");let n=v.value.findIndex(g=>g.id==t.id);n!=-1&&v.value.splice(n,1)}catch(d){console.log(d)}})},T=t=>{_.value=!0,m.value=t.name,i.value=t.permissions,p.value=t};return M(_,t=>{t==!1&&(p.value=void 0,m.value="",i.value=[])}),M(k,t=>{C()}),Z(()=>{C()}),(t,l)=>{const d=le,n=ee,g=oe,R=se,G=ne,z=ae,J=re,O=te,Q=ie,K=de,W=ue;return r(),j(ce,null,{default:s(()=>[a(R,{class:"justify-content-center"},{default:s(()=>[a(n,{cols:"12"},{default:s(()=>[a(O,{"no-body":""},{default:s(()=>[a(z,null,{default:s(()=>[a(R,{class:"align-items-center justify-content-between"},{default:s(()=>[a(n,{lg:"3"},{default:s(()=>[a(d,null,{default:s(()=>[y("ðŸ” Roles y Permisos")]),_:1})]),_:1}),a(n,{lg:"2"},{default:s(()=>[S(P).isPermitedRoute("register_role")?(r(),j(g,{key:0,type:"button",variant:"success",onClick:l[0]||(l[0]=o=>_.value=!_.value)},{default:s(()=>[_e,y(" Registrar ")]),_:1})):N("",!0)]),_:1})]),_:1}),a(R,{class:"align-items-center justify-content-between"},{default:s(()=>[a(n,{lg:"5"},{default:s(()=>[a(G,{type:"text",id:"role",modelValue:x.value,"onUpdate:modelValue":l[1]||(l[1]=o=>x.value=o),placeholder:"Buscar por role"},null,8,["modelValue"])]),_:1}),a(n,{lg:"3",md:"3"},{default:s(()=>[a(g,{type:"button",onClick:C,variant:"success"},{default:s(()=>[pe]),_:1}),a(g,{type:"button",onClick:H,variant:"dark",class:"mx-2"},{default:s(()=>[fe]),_:1})]),_:1})]),_:1})]),_:1}),a(J,{class:"pt-0"},{default:s(()=>[e("div",ve,[e("table",ge,[he,e("tbody",null,[(r(!0),c(w,null,E(v.value,(o,L)=>(r(),c("tr",{key:L},[e("td",null,f(o.id),1),e("td",null,f(o.name),1),e("td",null,[e("ul",null,[(r(!0),c(w,null,E(o.permissions,(h,B)=>(r(),c("li",{key:B},f(h),1))),128))])]),e("td",null,f(o.created_at),1),e("td",null,[S(P).isPermitedRoute("edit_role")?(r(),c("a",{key:0,href:"#",onclick:"return false;",onClick:h=>T(o)},ke,8,be)):N("",!0),y(f(" ")+" "),S(P).isPermitedRoute("delete_role")?(r(),c("a",{key:1,href:"#",onclick:"return false;",onClick:h=>F(o)},Re,8,xe)):N("",!0)])]))),128))])])])]),_:1})]),_:1}),a(Q,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=o=>k.value=o),"total-rows":U.value,"per-page":$.value,"prev-text":"Previous","next-text":"Next"},null,8,["modelValue","total-rows","per-page"])]),_:1})]),_:1}),a(W,{modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=o=>_.value=o),title:`ðŸ” ${p.value?"Editar":"Registrar"} un Rol`,"header-class":`bg-${I.value}`,"title-class":"m-0 text-white","ok-title":"Save changes","ok-variant":I.value,"cancel-title":"Close",centered:"","hide-footer":"",size:"md"},{default:s(()=>[a(R,null,{default:s(()=>[a(n,{cols:"9",class:"mb-3"},{default:s(()=>[Ee,a(G,{type:"text",id:"role",modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=o=>m.value=o),placeholder:"Admin de Sede"},null,8,["modelValue"])]),_:1}),a(n,{cols:"12"},{default:s(()=>[e("table",we,[Ve,e("tbody",null,[(r(!0),c(w,null,E(A.value,(o,L)=>(r(),c("tr",{key:L},[e("td",null,f(o.name),1),e("td",null,[e("ul",null,[(r(!0),c(w,null,E(o.permisos,(h,B)=>(r(),c("li",{style:{"list-style":"none"},class:"d-flex",key:B},[a(K,{checked:i.value.includes(h.permiso),onClick:Ne=>q(h)},null,8,["checked","onClick"]),e("span",Pe,f(h.name),1)]))),128))])])]))),128))])])]),_:1}),a(n,{lg:"12",class:"mt-3"},{default:s(()=>[e("div",Le,[a(g,{type:"button",variant:"secondary",onClick:l[4]||(l[4]=o=>_.value=!1)},{default:s(()=>[y(" Cerrar ")]),_:1}),a(g,{type:"button",variant:"primary",onClick:D},{default:s(()=>[y(f(p.value?"Editar":"Guardar"),1)]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue","title","header-class","ok-variant"])]),_:1})}}});export{Me as default};
