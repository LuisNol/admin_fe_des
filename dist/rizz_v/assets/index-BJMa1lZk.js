import{h as ne,r as u,P as se,l as q,m as l,q as r,t as a,T as de,N as re,L as ce,U as ie,J as i,s as ue,y as e,E as _e,a7 as pe,B as c,G as U,F as A,a8 as me,H as d,M as fe,x as ve,a5 as he,v as ge,D as v,V as C,u as I,af as ye,ad as G}from"./index-gLb9mm57.js";import{_ as ke,b as xe}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-t3Qmrl9p.js";import{H as L}from"./http-client-BDz097Pl.js";import{x as Ce,c as be}from"./logo-cdr-BoRzzDzm.js";import{S as b}from"./sweetalert2-D8dalEMJ.js";import"./ProcessingCircleAnimation-CnYI319d.js";const we="/rizz_v/assets/sunat-logo-DbhZd_WF.png",Ve="/rizz_v/assets/nota-c-Qwq1zopl.png",Ne=e("i",{class:"far fa-plus-square ml-3"},null,-1),Te=["value"],Ee=e("label",{for:"state_sale-product",class:"col-form-label text-lg-end"},"Tipo: ",-1),$e={class:""},De=e("label",{for:"type_payment-product",class:"col-form-label text-lg-end"},"Tipo de Pago: ",-1),Ae={class:"d-flex"},Ie=e("small",null,"Fecha de Inicio",-1),Le=e("small",null,"Fecha de Fin",-1),Pe=e("i",{class:"fas fa-search"},null,-1),Se=e("i",{class:"fas fa-sync"},null,-1),Be={class:"table-responsive m-0"},Ue={class:"table datatable"},Fe=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"N掳 de Venta"),e("th",null,"Cliente"),e("th",null,"Fecha de Emisi贸n"),e("th",null,"Tipo"),e("th",null,"Estado de Pago"),e("th",null,"Tipo de Pago"),e("th",null,"Igv"),e("th",null,"Comprobante"),e("th",null,"Total"),e("th",null,"Fac. Elec."),e("th",null,"Acci贸n")])],-1),ze={style:{width:"16px"}},Oe={class:"d-flex align-items-center"},Re={style:{"text-wrap-mode":"nowrap"}},qe={style:{"text-wrap-mode":"nowrap"}},Ge={class:"d-flex"},He={key:0},Me=["onClick"],Xe=["src"],Ze={key:1},je=["href"],Je=["src"],Qe={key:2},We=["href"],Ke=["src"],Ye={key:3},et=["onClick"],tt=["src"],at={class:"d-flex"},ot={href:"#",class:"text-muted fs-16 dropdown-toggle p-1","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true"},lt=e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1),nt=[lt],st={class:"dropdown-menu dropdown-menu-end","data-popper-placement":"bottom-end",style:{position:"absolute",inset:"0px 0px auto auto",margin:"0px",transform:"translate(0px, 30px)"}},dt=["href"],rt=e("i",{class:"fas fa-file-medical fs-18"},null,-1),ct=["href"],it=e("i",{class:"fas fa-file-alt fs-18"},null,-1),ut=["onClick"],_t=e("i",{class:"fas fa-file-pdf text-secondary fs-22"},null,-1),pt=[_t],mt=["onClick"],ft=e("i",{class:"las la-pen text-secondary fs-22"},null,-1),vt=[ft],ht=["onClick"],gt=e("i",{class:"las la-trash-alt text-secondary fs-22"},null,-1),yt=[gt],Tt=ne({__name:"index",setup(kt){const w=u(""),V=u(""),F=u([]),N=u(""),T=u(""),m=u(0),f=u(0),E=u(""),$=u(""),h=u([]),z=u(25),O=u(0),P=u(1),H=async()=>{try{const n=await L.get("products/config");console.log(n),F.value=n.data.categories}catch(n){console.log(n)}},M=n=>n==1?"PENDIENTE":n==2?"PARCIAL":"TOTAL",S=async()=>{try{const n=await L.post("sales/index?page="+P.value,{search_product:w.value,categorie_id:V.value,search:N.value,search_client:T.value,state_sale:m.value,type_payment:f.value,start_date:E.value,end_date:$.value});console.log(n),h.value=n.data.sales.data,O.value=n.data.total,z.value=n.data.pagination}catch(n){console.log(n)}},X=()=>{w.value="",N.value="",T.value="",E.value="",$.value="",m.value=0,f.value=0,V.value="",S()},Z=async n=>{window.open("https://api-fe.avisonline.store/api/sales-pdf/"+n.id,"_blank")},j=async n=>{G.push({name:"sales.edit",params:{id:n.id}})},J=async n=>{b.fire({title:"Confirmar la eliminaci贸n",text:`驴Estas seguro de eliminar esta ${n.state_sale==1?"VENTA":"COTIZACIN"} '${n.id}' ?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminalo!"}).then(async o=>{if(o.isConfirmed)try{const p=await L.delete("sales/"+n.id);console.log(p),b.fire("Genial!",p.data.message,"success");let s=h.value.findIndex(g=>g.id==n.id);s!=-1&&h.value.splice(s,1)}catch(p){console.log(p)}})},Q=async n=>{var o,p;try{const s=await L.post("seend_sunat",{sale_id:n.id});if(console.log(s),s.data.error){b.fire("Upps!",`(${s.data.error.code}) ${s.data.error.message}`,"error");return}if(s.data.sale){let g=h.value.findIndex(D=>D.id==s.data.sale.id);g!=-1&&(h.value[g]=s.data.sale,b.fire("Genial!","Tu venta ha sido reportada a SUNAT, podras tener la constancia del XML y del CDR","success"))}}catch(s){if(console.log(s),(o=s.response)!=null&&o.data){b.fire("Upps!",(p=s.response)==null?void 0:p.data.message,"error");return}}},W=async n=>{G.push({name:"nota.electronica",params:{id:n.id}})};return se(()=>{H(),S()}),(n,o)=>{const p=ie,s=ce,g=ue("router-link"),D=re,k=_e,K=pe,y=me,R=fe,Y=de,ee=xe,te=he,ae=ve,oe=ge,x=ye;return r(),q(ke,null,{default:l(()=>[a(oe,null,{default:l(()=>[a(Y,null,{default:l(()=>[a(D,{class:"align-items-center justify-content-between"},{default:l(()=>[a(s,{lg:"3"},{default:l(()=>[a(p,null,{default:l(()=>[i(" LISTA DE VENTAS")]),_:1})]),_:1}),a(s,{lg:"3"},{default:l(()=>[a(g,{to:"/sale/register",type:"button",variant:"success"},{default:l(()=>[Ne,i(" Registrar Nuevo Venta ")]),_:1})]),_:1})]),_:1}),a(D,{class:"align-items-center mt-3"},{default:l(()=>[a(s,{lg:"4",md:"4"},{default:l(()=>[a(k,{type:"text",modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=t=>w.value=t),id:"name-product",placeholder:"Buscar por nombre o sku del producto"},null,8,["modelValue"])]),_:1}),a(s,{lg:"3",md:"3"},{default:l(()=>[a(K,{id:"categorie-product",modelValue:V.value,"onUpdate:modelValue":o[1]||(o[1]=t=>V.value=t)},{default:l(()=>[(r(!0),c(A,null,U(F.value,(t,B)=>(r(),c("option",{key:B,value:t.id},d(t.title),9,Te))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{lg:"2",md:"2"},{default:l(()=>[a(k,{type:"number",modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=t=>N.value=t),id:"n_ventas",placeholder:"Buscar por N掳 de Venta"},null,8,["modelValue"])]),_:1}),a(s,{lg:"3",md:"3"},{default:l(()=>[a(k,{type:"text",modelValue:T.value,"onUpdate:modelValue":o[3]||(o[3]=t=>T.value=t),id:"n_ventas",placeholder:"Buscar por nombre de cliente"},null,8,["modelValue"])]),_:1}),a(s,{lg:"2",md:"2"},{default:l(()=>[Ee,e("div",$e,[a(y,{name:"state_sale",onClick:o[4]||(o[4]=t=>m.value=1),value:"1",checked:m.value==1},{default:l(()=>[i("Venta")]),_:1},8,["checked"]),i(" "+d(" ")+" "),a(y,{name:"state_sale",onClick:o[5]||(o[5]=t=>m.value=2),value:"2",class:"",checked:m.value==2},{default:l(()=>[i("Cotizaci贸n")]),_:1},8,["checked"]),i(" "+d(" ")+" "),a(y,{name:"state_sale",onClick:o[6]||(o[6]=t=>m.value=0),value:"0",class:"",checked:m.value==0},{default:l(()=>[i("Ninguno")]),_:1},8,["checked"])])]),_:1}),a(s,{lg:"4",md:"4"},{default:l(()=>[De,e("div",Ae,[a(y,{name:"type_payment",onClick:o[7]||(o[7]=t=>f.value=1),value:"1",checked:f.value==1},{default:l(()=>[i("Al Contado")]),_:1},8,["checked"]),i(" "+d(" ")+" "),a(y,{name:"type_payment",onClick:o[8]||(o[8]=t=>f.value=2),value:"2",class:"mx-1",checked:f.value==2},{default:l(()=>[i("Credito")]),_:1},8,["checked"]),i(" "+d(" ")+" "),a(y,{name:"type_payment",onClick:o[9]||(o[9]=t=>f.value=0),value:"0",class:"mx-1",checked:f.value==0},{default:l(()=>[i("Ninguno")]),_:1},8,["checked"])])]),_:1}),a(s,{lg:"2",md:"2"},{default:l(()=>[a(k,{type:"date",id:"n-f-start_date",modelValue:E.value,"onUpdate:modelValue":o[10]||(o[10]=t=>E.value=t),placeholder:""},null,8,["modelValue"]),Ie]),_:1}),a(s,{lg:"2",md:"2"},{default:l(()=>[a(k,{type:"date",id:"n-f-end_date",modelValue:$.value,"onUpdate:modelValue":o[11]||(o[11]=t=>$.value=t),placeholder:""},null,8,["modelValue"]),Le]),_:1}),a(s,{lg:"2",md:"2"},{default:l(()=>[a(R,{type:"button",onClick:S,variant:"success"},{default:l(()=>[Pe]),_:1}),a(R,{type:"button",onClick:X,variant:"dark",class:"mx-2"},{default:l(()=>[Se]),_:1})]),_:1})]),_:1})]),_:1}),a(ae,{class:"pt-0"},{default:l(()=>[e("div",Be,[e("table",Ue,[Fe,e("tbody",null,[(r(!0),c(A,null,U(h.value,(t,B)=>(r(),c("tr",{key:B},[e("td",ze,d(t.id),1),e("td",null,[e("div",Oe,[e("span",null,d(t.client.full_name),1)])]),e("td",null,d(t.created_at_format),1),e("td",null,d(t.state_sale==1?"VENTA":"COTIZACIN"),1),e("td",null,d(M(t.state_payment)),1),e("td",null,d(t.type_payment==1?"AL CONTADO":"CREDITO"),1),e("td",Re,d(t.currency)+" "+d(t.igv_general),1),e("td",null,d(t.serie),1),e("td",qe,d(t.currency)+" "+d(t.total_general),1),e("td",null,[e("div",Ge,[t.correlativo?v("",!0):(r(),c("div",He,[t.state_sale==1?C((r(),c("a",{key:0,href:"#",onclick:"return false;",onClick:_=>Q(t)},[e("img",{src:I(we),width:"45",alt:""},null,8,Xe)],8,Me)),[[x,"Enviar a Sunat",void 0,{hover:!0,top:!0}]]):v("",!0)])),t.correlativo?(r(),c("div",Ze,[C((r(),c("a",{href:t.xml,target:"_blank"},[e("img",{src:I(Ce),width:"45",alt:""},null,8,Je)],8,je)),[[x,"Descargar XML",void 0,{hover:!0,top:!0}]])])):v("",!0),t.correlativo?(r(),c("div",Qe,[C((r(),c("a",{href:t.cdr,target:"_blank"},[e("img",{src:I(be),width:"45",alt:""},null,8,Ke)],8,We)),[[x,"Descargar CDR",void 0,{hover:!0,top:!0}]])])):v("",!0),t.correlativo&&t.serie=="F001"?(r(),c("div",Ye,[C((r(),c("a",{href:"#",onclick:"return false;",onClick:_=>W(t)},[e("img",{src:I(Ve),width:"40",alt:""},null,8,tt)],8,et)),[[x,"Generar Nota",void 0,{hover:!0,top:!0}]])])):v("",!0)])]),e("td",null,[e("div",at,[t.notas.length>0?(r(),q(ee,{key:0,"custom-class":"float-start",class:"mx-1"},{default:l(()=>[C((r(),c("a",ot,nt)),[[x,"Notas",void 0,{hover:!0,top:!0}]]),e("div",st,[(r(!0),c(A,null,U(t.notas,(_,le)=>(r(),c(A,{key:le},[_.doc_nota=="07"?(r(),c("a",{key:0,class:"dropdown-item",target:"_blank",href:_.url},[rt,i(" N. Credito: "+d(_.n_operacion),1)],8,dt)):v("",!0),_.doc_nota=="08"?(r(),c("a",{key:1,class:"dropdown-item",target:"_blank",href:_.url},[it,i(" N. Debito: "+d(_.n_operacion),1)],8,ct)):v("",!0)],64))),128))])]),_:2},1024)):v("",!0),e("a",{href:"#",onclick:"return false;",onClick:_=>Z(t)},pt,8,ut),i(d(" ")+" "),e("a",{href:"#",onclick:"return false;",onClick:_=>j(t)},vt,8,mt),i(d(" ")+" "),e("a",{href:"#",onclick:"return false;",onClick:_=>J(t)},yt,8,ht)])])]))),128))])])]),a(te,{modelValue:P.value,"onUpdate:modelValue":o[12]||(o[12]=t=>P.value=t),"total-rows":O.value,"per-page":z.value,"prev-text":"Previous","next-text":"Next"},null,8,["modelValue","total-rows","per-page"])]),_:1})]),_:1})]),_:1})}}});export{Tt as default};
